DELIMITER $$
	CREATE TRIGGER calculoHorasTotalesYValidacionChequeo
		BEFORE INSERT
		ON chequeo FOR EACH ROW
	BEGIN
		IF (SELECT 1 FROM chequeo WHERE fecha_chequeo = NEW.fecha_chequeo AND 
		ID_colaborador = NEW.ID_colaborador AND numero_chequeo = (SELECT MAX(numero_chequeo) FROM chequeo
		WHERE fecha_chequeo = NEW.fecha_chequeo AND ID_colaborador = NEW.ID_colaborador) 
		AND (hora_final IS NULL OR tiempo_total IS NULL)) <> 0 THEN		
			SIGNAL SQLSTATE '45000' SET message_text = "Se debe completar el último chequeo del día antes de registrar uno nuevo para la fecha especificada.";
		END IF;
  
		IF NEW.hora_final IS NOT NULL THEN
			SET NEW.tiempo_total = TIMEDIFF(NEW.hora_final, NEW.hora_inicial);
		ELSE
			IF NEW.tiempo_total IS NOT NULL THEN
				SET NEW.hora_final = SEC_TO_TIME(TIME_TO_SEC(NEW.hora_inicial) + TIME_TO_SEC(NEW.tiempo_total));
			END IF;
		END IF;
	END$$    
DELIMITER ;

DELIMITER $$
	CREATE TRIGGER calculoHorasTotalesActualizacion
		BEFORE UPDATE
		ON chequeo FOR EACH ROW
	BEGIN
		IF NEW.hora_final IS NOT NULL THEN
			SET NEW.tiempo_total = TIMEDIFF(NEW.hora_final, NEW.hora_inicial);
		ELSE
			IF (NEW.tiempo_total IS NOT NULL AND NEW.tiempo_total <> OLD.tiempo_total) THEN
				SET NEW.hora_final = SEC_TO_TIME(TIME_TO_SEC(NEW.hora_inicial) + TIME_TO_SEC(NEW.tiempo_total));
			ELSE
				SET NEW.tiempo_total = NULL;
			END IF;
		END IF;
	END$$    
DELIMITER ;

DELIMITER $$
	CREATE TRIGGER calculoHorasContingencia
		BEFORE INSERT
		ON contingencia FOR EACH ROW
	BEGIN
		SET NEW.tiempo_total = TIMEDIFF(NEW.hora_final, NEW.hora_inicial);
	END$$    
DELIMITER ;

DELIMITER $$
	CREATE TRIGGER calculoHorasContingenciaActualizacion
		BEFORE UPDATE
		ON contingencia FOR EACH ROW
	BEGIN
		SET NEW.tiempo_total = TIMEDIFF(NEW.hora_final, NEW.hora_inicial);
	END$$    
DELIMITER ;